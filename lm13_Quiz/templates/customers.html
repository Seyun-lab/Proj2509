<!DOCTYPE html>
  <html lang="ko">
  <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <title>Purchase Predict(AJAX)</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
      <style>
        body { background: #f6f8fa; }
        .container-narrow { max-width: 880px; }
        .form-label { font-weight: 600; }
        .result-number { font-size: 1.75rem; font-weight: 700; }
        .muted { color:#6c757d; }
      </style>
  </head>
  <body class="py-4">
      <div class="container container-narrow">
          <header class="mb-4">
              <h1 class="h3 mb-1">품목별 소비액에 따른 가구 유아수 예측</h1>
          </header>
      <div class="card shadow-sm mb-3">
          <div class="card-body">
              <form id="predict-form" method="post" onsubmit="return submitPredict(event);">
                  {% csrf_token %}
                  <div class="row g-3">
                      <div class="col-md-6">
                          <label for="mntwines" class="form-label">와인 소비액</label>
                          <input type="number" step="any" class="form-control" id="mntwines" name="mntwines" placeholder="예: 200" required />
                      </div>
                      <div class="col-md-6">
                          <label for="mntfruits" class="form-label">과일 소비액</label>
                          <input type="number" step="any" class="form-control" id="mntfruits" name="mntfruits" placeholder="예: 50" required />
                      </div>
                      <div class="col-md-6">
                          <label for="mntmeatproducts" class="form-label">육류 소비액</label>
                          <input type="number" step="any" class="form-control" id="mntmeatproducts" name="mntmeatproducts" placeholder="예: 100" required />
                      </div>
                      <div class="col-md-6">
                          <label for="mntfishproducts" class="form-label">어류 소비액</label>
                          <input type="number" step="any" class="form-control" id="mntfishproducts" name="mntfishproducts" placeholder="예: 30" required />
                      </div>
                      <div class="col-md-6">
                          <label for="mntsweetproducts" class="form-label">디저트류 구매액</label>
                          <input type="number" step="any" class="form-control" id="mntsweetproducts" name="mntsweetproducts" placeholder="예: 10" required />
                      </div>
                      <div class="col-md-6">
                          <label for="mntgoldprods" class="form-label">할인 혜택 없는 상품 구매액</label>
                          <input type="number" step="any" class="form-control" id="mntgoldprods" name="mntgoldprods" placeholder="예: 20" required />
                      </div>
                  </div>
                  <div class="d-flex align-items-center gap-2 mt-3">
                      <button type="submit" class="btn btn-primary px-4">입력</button>
                      <button type="button" class="btn btn-outline-secondary" onclick="clearForm()">지우기</button>
                  </div>
              </form>
          </div>
      </div>

      <div class="row g-3">
          <div class="col-md-7">
              <div class="card shadow-sm h-100">
                  <div class="card-body">
                      <h5 class="card-title mb-2">예측 결과</h5>
                      <div id="result" class="result-number">--</div>
                  </div>
              </div>
          </div>
          <div class="col-md-5">
              <div class="card shadow-sm h-100">
                  <div class="card-body">
                      <h6 class="card-subtitle text-muted mb-2">입력값 미리보기</h6>
                      <ul class="list-group list-group-flush" id="preview-list">
                          <li class="list-group-item d-flex justify-content-between"><span>와인 소비액</span><span id="pv-wines" class="fw-semibold">-</span></li>
                          <li class="list-group-item d-flex justify-content-between"><span>과일 소비액</span><span id="pv-fruits" class="fw-semibold">-</span></li>
                          <li class="list-group-item d-flex justify-content-between"><span>육류 소비액</span><span id="pv-meat" class="fw-semibold">-</span></li>
                          <li class="list-group-item d-flex justify-content-between"><span>어류 소비액</span><span id="pv-fish" class="fw-semibold">-</span></li>
                          <li class="list-group-item d-flex justify-content-between"><span>디저트류 구매액</span><span id="pv-sweet" class="fw-semibold">-</span></li>
                          <li class="list-group-item d-flex justify-content-between"><span>할인 혜택 없는 상품 구매액</span><span id="pv-gold" class="fw-semibold">-</span></li>
                      </ul>
                  </div>
              </div>
          </div>
      </div>

      <footer class="text-center mt-4 muted small">
          Ⓒ 1조 첫 프로젝트
      </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script>
    function getCsrfToken() {
      const el = document.querySelector('input[name="csrfmiddlewaretoken"]');
      return el ? el.value : '';
    }
    function num(v) { return v === '' || v == null ? '-' : Number(v).toLocaleString('ko-KR'); }
    function syncPreview() {
      document.getElementById('pv-wines').textContent = num(document.getElementById('mntwines').value);
      document.getElementById('pv-fruits').textContent = num(document.getElementById('mntfruits').value);
      document.getElementById('pv-meat').textContent   = num(document.getElementById('mntmeatproducts').value);
      document.getElementById('pv-fish').textContent   = num(document.getElementById('mntfishproducts').value);
      document.getElementById('pv-sweet').textContent  = num(document.getElementById('mntsweetproducts').value);
      document.getElementById('pv-gold').textContent   = num(document.getElementById('mntgoldprods').value);
    }
    ['mntwines','mntfruits','mntmeatproducts','mntfishproducts','mntsweetproducts','mntgoldprods'].forEach(id => {
      document.addEventListener('input', e => { if (e.target && e.target.id === id) syncPreview(); });
    });
    function clearForm() {
      document.getElementById('predict-form').reset();
      syncPreview();
      document.getElementById('result').textContent = '--';
    }

    async function submitPredict(e) {
      if (e) e.preventDefault();
      const form = document.getElementById('predict-form');
      const formData = new FormData(form);
      try {
          const res = await fetch(window.location.pathname, {
              method: 'POST',
              headers: {
                  'X-Requested-With': 'XMLHttpRequest',
                  'X-CSRFToken': getCsrfToken(),
              },
              body: formData
          });
          if (!res.ok) {
              const text = await res.text();
              alert('요청 실패: ' + text);
              return false;
          }
          const data = await res.json();
          const display = (data && data.result !== undefined) ? data.result : null;
          document.getElementById('result').textContent = (display == null) ? '예측값 없음' : display;
      } catch (err) {
          console.error(err);
          alert('요청 중 오류가 발생했습니다.');
      }
      return false;
    }
    // 초기 프리뷰 동기화
    syncPreview();
  </script>
</body>
</html>
